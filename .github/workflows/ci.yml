name: CI
on:
  pull_request:
  push:
    branches:
      - master
jobs:
  build-and-test:
    runs-on: macos-13
    strategy:
      matrix:
        xcode-version: [ 14.3 ]
        ios-version: [ 16.4 ]
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Select Xcode
        run: sudo xcode-select -s '/Applications/Xcode_${{ matrix.xcode-version }}.app/Contents/Developer'
      
      - name: Install xcodegen
        run: brew install xcodegen

      - name: Generate xcodeproj
        run: xcodegen generate 

      - name: Bulid and test
        run: |
          set -o pipefail
          xcodebuild \
            -project CoffeeBrew46.xcodeproj \
            -scheme coffeebrew46 \
            -destination "platform=iOS Simulator,OS=${{ matrix.ios-version }},name=iPhone 14" \
            -sdk iphonesimulator${{ matrix.ios-version }} test | xcpretty -c
